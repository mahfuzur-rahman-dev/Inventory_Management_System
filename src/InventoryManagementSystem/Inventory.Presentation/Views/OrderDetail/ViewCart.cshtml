@model IEnumerable<OrderDetail>

<div class="container">
    <h2>Your Cart</h2>

    @if (Model.Any())
    {
        <!-- Declare variables to hold total quantity and total amount -->
        int totalQuantity = 0;
        decimal totalAmount = 0;

        <table class="table">
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Quantity</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <!-- Increment total quantity and total amount -->
                    totalQuantity += item.TotalQuantity;
                    totalAmount += item.TotalAmount;

                    <tr>
                        <td>@item.Product.Name</td> <!-- Assuming Product has a Name property -->
                        <td>@item.TotalQuantity</td>
                        <td>@item.TotalAmount.ToString("C")</td> <!-- Format as currency -->
                    </tr>
                }
            </tbody>
        </table>

        <div class="row">
            <div class="col-md-6">
                <h4>Total Quantity: @totalQuantity</h4> <!-- Display the total quantity -->
            </div>
            <div class="col-md-6 text-right">
                <h4>Total Amount: @totalAmount.ToString("C")</h4> <!-- Display the total amount formatted as currency -->
            </div>
        </div>

        <div class="col-12 col-md-6">
            <button onclick="return placeOrder('@totalQuantity','@totalAmount')" type="button" class="btn btn-primary form-control py-2">Place order</button>
        </div>

    }
    else
    {
        <p>Your cart is empty.</p>
    }
</div>


@section Scripts {
    <script type="text/javascript">

        function placeOrder(totalQuantity, totalAmount) {
            $.ajax({
                url: '@Url.Action("PlaceOrder", "Order")',
                type: 'POST',
                data: {
                    totalQuantity: totalQuantity,
                    totalAmount: totalAmount
                },
                success: function (response) {
                    if (response.success) {
                        Swal.fire('Order placed successfully!', '', 'success').then(() => {
                            window.location.href = '@Url.Action("Index", "Product")';
                        });
                    } else {
                        Swal.fire('Failed to place the order.', response.message || '', 'error');
                    }
                },
                error: function () {
                    Swal.fire('Error occurred while placing the order.', '', 'error');
                }
            });

            return false;
        }
    </script>
}



